<?
header('Content-type: text/html; charset=utf-8');
header("Access-Control-Allow-Origin: null");
ini_set('error_reporting', E_ERROR | E_WARNING | E_PARSE);
ini_set("display_errors","Off");
include_once("include.php"); 
include_once "start.php";
include_once ("requiredDBTasks.php");
include_once "sigweathercalc.php";

$forecastDaysDB = $mem->get('forecastDaysDB');
$forecastHour = $mem->get('forecasthour');
$sigforecastHour = $mem->get('sigforecastHour');
if (empty($forecastHour)){
    $forecastlib_origin = "02wsjson.php";
    include_once("forecastlib.php");
    $forecastHour = $mem->get("forecasthour");
}
//include_once("lastdaylib.php");
include_once("periodicDBTasks.php");
include_once "runwalkcalc.php";
include_once "forecastcalc.php";
$output_json_file_path = "/home/boazn/public/02ws.com/public/02wsjson.txt";
$output_json_file_path_short = "/home/boazn/public/02ws.com/public/02wsjsonshort.json";
$JSON_ROOT = "{\"jws\":";
$JSON = $JSON_ROOT;
$CURRENT_JSON = "{\"current\":";
$CURRENT_JSON .= "{";
$CURRENT_JSON .= "\"date0\":"."\"".$date."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"date1\":"."\"".$dateInHeb."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"daytime0\":"."\"".$daytime."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"daytime1\":"."\"".$daytimeInHeb."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"time\":"."\"".$current->get_time()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"temp\":"."\"".$current->get_temp()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"temp2\":"."\"".$current->get_temp2()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"temp3\":"."\"".$current->get_temp3()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"primary_temp\":"."\"".$PRIMARY_TEMP."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"hum\":"."\"".$current->get_hum()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"hum2\":"."\"".$current->get_hum2()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"dew\":"."\"".$current->get_dew()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"pressure\":"."\"".$current->get_pressure()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"winddir\":"."\"".$current->get_winddir()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"windspd\":"."\"".$current->get_windspd()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"windspd10min\":"."\"".$min10->get_windspd()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"rainrate\":"."\"".$current->get_rainrate()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"rainchance\":"."\"".$current->get_rainchance()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"cloudbase\":"."\"".$current->get_cloudbase()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"windchill\":"."\"".$current->get_windchill()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"heatidx\":"."\"".$current->get_heatidx()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"thw\":"."\"".$current->get_thw()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"thsw\":"."\"".$current->get_thsw()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"intemp\":"."\"".$current->get_intemp()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"tempunit\":"."\"".$current->get_tempunit()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"solarradiation\":"."\"".$current->get_solarradiation()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"uv\":"."\"".$current->get_uv()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"pm10\":"."\"".$current->get_pm10()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"pm25\":"."\"".$current->get_pm25()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"pm10sd\":"."\"".$current->get_pm10sd()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"pm25sd\":"."\"".$current->get_pm25sd()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"cloudiness\":"."\"".$current->get_cloudiness()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"islight\":"."\"".$current->is_light()."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"iswindy\":"."\"".($min10->get_windspd() > 30 ? "true" : "false")."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"isdusty\":"."\"".($current->get_pm10() > 250 ? "true" : "false")."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"isheatwave\":"."\"".($isHeatWave ? "true" : "false")."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"issun\":"."\"".($current->is_sun() ? "true" : "false")."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"issunset\":"."\"".($current->is_sunset() ? "true" : "false")."\"";
$CURRENT_JSON .= ",";
$CURRENT_JSON .= "\"issunrise\":"."\"".($current->is_sunrise()? "true" : "false")."\"";
$CURRENT_JSON .= ",\"recommendations\":[";
foreach ($recommendations as $r){
$CURRENT_JSON .= "{";
$CURRENT_JSON .= "\"activity\":"."\"".$r['activity']."\",";
//$CURRENT_JSON .= "\"sig\":"."\"".$r['sig']."\",";
$CURRENT_JSON .= "\"value\":"."\"".$r['value']."\"";
$CURRENT_JSON .= "},";
}
$CURRENT_JSON = trim($CURRENT_JSON, ",");
$CURRENT_JSON .= "]";
$CURRENT_JSON .= "}";

$JSON .= $CURRENT_JSON;
$JSON .= ",\"min15\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".$min15->get_date()."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$min15->get_time()."\"";
$JSON .= ",";
$JSON .= "\"minutes\":"."\"".getLastUpdateMin()."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$min15->get_temp()."\"";
$JSON .= ",";
$JSON .= "\"temp2\":"."\"".$min15->get_temp2()."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$min15->get_hum()."\"";
$JSON .= ",";
$JSON .= "\"pm10\":"."\"".$min15->get_pm10()."\"";
$JSON .= ",";
$JSON .= "\"pm25\":"."\"".$min15->get_pm25()."\"";
$JSON .= ",";
$JSON .= "\"pressure\":"."\"".$min15->get_pressure()."\"";
$JSON .= ",";
$JSON .= "\"winddir\":"."\"".$min15->get_winddir()."\"";
$JSON .= ",";
$JSON .= "\"windspd\":"."\"".$min15->get_windspd()."\"";
$JSON .= ",";
$JSON .= "\"rainrate\":"."\"".$min15->get_rainrate()."\"";
$JSON .= ",";
$JSON .= "\"cloudbase\":"."\"".$min15->get_cloudbase()."\"";
$JSON .= ",";
$JSON .= "\"windchill\":"."\"".$min15->get_windchill()."\"";
$JSON .= ",";
$JSON .= "\"heatidx\":"."\"".$min15->get_heatidx()."\"";
$JSON .= ",";
$JSON .= "\"thw\":"."\"".$min15->get_thw()."\"";
$JSON .= ",";
$JSON .= "\"tempchange\":"."\"".$min15->get_tempchange().",".str_replace('"', '\"',get_img_tag($min15->get_tempchange(), true)).",".str_replace('"', '\"',get_param_tag($min15->get_tempchange(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp2change\":"."\"".$min15->get_temp2change().",".str_replace('"', '\"',get_img_tag($min15->get_temp2change(), true)).",".str_replace('"', '\"',get_param_tag($min15->get_temp2change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp3change\":"."\"".$min15->get_temp3change().",".str_replace('"', '\"',get_img_tag($min15->get_temp3change(), true)).",".str_replace('"', '\"',get_param_tag($min15->get_temp3change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"humchange\":"."\"".number_format($min15->get_humchange()).",".str_replace('"', '\"',get_img_tag($min15->get_humchange(), true)).",".str_replace('"', '\"',get_img_tag($min15->get_humchange(), true).abs($min15->get_humchange()))."\"";
$JSON .= ",";
$JSON .= "\"rainratechange\":"."\"".number_format($min15->get_rainratechange()).",".str_replace('"', '\"',get_img_tag($min15->get_rainratechange(), true)).",".str_replace('"', '\"',get_img_tag($min15->get_rainratechange(), true).abs($min15->get_rainratechange()))."\"";
$JSON .= ",";
$JSON .= "\"tempunit\":"."\"".$min15->get_tempunit()."\"";
$JSON .= ",";
$JSON .= "\"solarradiation\":"."\"".$min15->get_solarradiation()."\"";
$JSON .= ",";
$JSON .= "\"srchange\":"."\"".number_format($min15->get_srchange()).",".str_replace('"', '\"',get_img_tag($min15->get_srchange(), true)).",".str_replace('"', '\"',get_img_tag($min15->get_srchange(), true).abs($min15->get_srchange()))."\"";
$JSON .= ",";
$JSON .= "\"cloudiness\":"."\"".$min15->get_cloudiness()."\"";
$JSON .= "}";

$JSON .= ",\"min30\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".$min30->get_date()."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$min30->get_time()."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$min30->get_temp()."\"";
$JSON .= ",";
$JSON .= "\"temp2\":"."\"".$min30->get_temp2()."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$min30->get_hum()."\"";
$JSON .= ",";
$JSON .= "\"dew\":"."\"".$min30->get_dew()."\"";
$JSON .= ",";
$JSON .= "\"pm10\":"."\"".$min30->get_pm10()."\"";
$JSON .= ",";
$JSON .= "\"pm25\":"."\"".$min30->get_pm25()."\"";
$JSON .= ",";
$JSON .= "\"pressure\":"."\"".$min30->get_pressure()."\"";
$JSON .= ",";
$JSON .= "\"winddir\":"."\"".$min30->get_winddir()."\"";
$JSON .= ",";
$JSON .= "\"windspd\":"."\"".$min30->get_windspd()."\"";
$JSON .= ",";
$JSON .= "\"rainrate\":"."\"".$min30->get_rainrate()."\"";
$JSON .= ",";
$JSON .= "\"cloudbase\":"."\"".$min30->get_cloudbase()."\"";
$JSON .= ",";
$JSON .= "\"windchill\":"."\"".$min30->get_windchill()."\"";
$JSON .= ",";
$JSON .= "\"heatidx\":"."\"".$min30->get_heatidx()."\"";
$JSON .= ",";
$JSON .= "\"thw\":"."\"".$min30->get_thw()."\"";
$JSON .= ",";
$JSON .= "\"uv\":"."\"".$min30->get_uv()."\"";
$JSON .= ",";
$JSON .= "\"uvchange\":"."\"".number_format($min30->get_uvchange()).",".str_replace('"', '\"',get_img_tag($min30->get_uvchange(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_uvchange(), true).abs($min30->get_uvchange()))."\"";
$JSON .= ",";
$JSON .= "\"tempchange\":"."\"".$min30->get_tempchange().",".str_replace('"', '\"',get_img_tag($min30->get_tempchange(), true)).",".str_replace('"', '\"',get_param_tag($min30->get_tempchange(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp2change\":"."\"".$min30->get_temp2change().",".str_replace('"', '\"',get_img_tag($min30->get_temp2change(), true)).",".str_replace('"', '\"',get_param_tag($min30->get_temp2change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp3change\":"."\"".$min30->get_temp3change().",".str_replace('"', '\"',get_img_tag($min30->get_temp3change(), true)).",".str_replace('"', '\"',get_param_tag($min30->get_temp3change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"humchange\":"."\"".number_format($min30->get_humchange()).",".str_replace('"', '\"',get_img_tag($min30->get_humchange(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_humchange(), true).abs($min30->get_humchange()))."\"";
$JSON .= ",";
$JSON .= "\"dewchange\":"."\"".number_format($min30->get_dewchange()).",".str_replace('"', '\"',get_img_tag($min30->get_dewchange(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_dewchange(), true).abs($min30->get_dewchange()))."\"";
$JSON .= ",";
$JSON .= "\"rainratechange\":"."\"".number_format($min30->get_rainratechange()).",".str_replace('"', '\"',get_img_tag($min30->get_rainratechange(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_rainratechange(), true).abs($min30->get_rainratechange()))."\"";
$JSON .= ",";
$JSON .= "\"tempunit\":"."\"".$min30->get_tempunit()."\"";
$JSON .= ",";
$JSON .= "\"solarradiation\":"."\"".$min30->get_solarradiation()."\"";
$JSON .= ",";
$JSON .= "\"srchange\":"."\"".number_format($min30->get_srchange()).",".str_replace('"', '\"',get_img_tag($min30->get_srchange(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_srchange(), true).abs($min30->get_srchange()))."\"";
$JSON .= ",";
$JSON .= "\"pm10change\":"."\"".number_format($min30->get_pm10change()).",".str_replace('"', '\"',get_img_tag($min30->get_pm10change(), true)).",".str_replace('"', '\"',get_img_tag($min30->get_pm10change(), true).abs($min30->get_pm10change()))."\"";
$JSON .= ",";
$JSON .= "\"cloudiness\":"."\"".$min30->get_cloudiness()."\"";
$JSON .= "}";

$JSON .= ",\"oneHour\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".$oneHour->get_date()."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$oneHour->get_time()."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$oneHour->get_temp()."\"";
$JSON .= ",";
$JSON .= "\"temp2\":"."\"".$oneHour->get_temp2()."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$oneHour->get_hum()."\"";
$JSON .= ",";
$JSON .= "\"dew\":"."\"".$oneHour->get_dew()."\"";
$JSON .= ",";
$JSON .= "\"pressure\":"."\"".$oneHour->get_pressure()."\"";
$JSON .= ",";
$JSON .= "\"winddir\":"."\"".$oneHour->get_winddir()."\"";
$JSON .= ",";
$JSON .= "\"windspd\":"."\"".$oneHour->get_windspd()."\"";
$JSON .= ",";
$JSON .= "\"rainrate\":"."\"".$oneHour->get_rainrate()."\"";
$JSON .= ",";
$JSON .= "\"cloudbase\":"."\"".$oneHour->get_cloudbase()."\"";
$JSON .= ",";
$JSON .= "\"windchill\":"."\"".$oneHour->get_windchill()."\"";
$JSON .= ",";
$JSON .= "\"heatidx\":"."\"".$oneHour->get_heatidx()."\"";
$JSON .= ",";
$JSON .= "\"uv\":"."\"".$oneHour->get_uv()."\"";
$JSON .= ",";
$JSON .= "\"uvchange\":"."\"".number_format($oneHour->get_uvchange()).",".str_replace('"', '\"',get_img_tag($oneHour->get_uvchange(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_uvchange(), true).abs($oneHour->get_uvchange()))."\"";
$JSON .= ",";
$JSON .= "\"thw\":"."\"".$oneHour->get_thw()."\"";
$JSON .= ",";
$JSON .= "\"tempchange\":"."\"".$oneHour->get_tempchange().",".str_replace('"', '\"',get_img_tag($oneHour->get_tempchange(), true)).",".str_replace('"', '\"',get_param_tag($oneHour->get_tempchange(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp2change\":"."\"".$oneHour->get_temp2change().",".str_replace('"', '\"',get_img_tag($oneHour->get_temp2change(), true)).",".str_replace('"', '\"',get_param_tag($oneHour->get_temp2change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp3change\":"."\"".$oneHour->get_temp3change().",".str_replace('"', '\"',get_img_tag($oneHour->get_temp3change(), true)).",".str_replace('"', '\"',get_param_tag($oneHour->get_temp3change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"humchange\":"."\"".number_format($oneHour->get_humchange()).",".str_replace('"', '\"',get_img_tag($oneHour->get_humchange(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_humchange(), true).abs($oneHour->get_humchange()))."\"";
$JSON .= ",";
$JSON .= "\"dewchange\":"."\"".number_format($oneHour->get_dewchange()).",".str_replace('"', '\"',get_img_tag($oneHour->get_dewchange(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_dewchange(), true).abs($oneHour->get_dewchange()))."\"";
$JSON .= ",";
$JSON .= "\"tempunit\":"."\"".$oneHour->get_tempunit()."\"";
$JSON .= ",";
$JSON .= "\"rainratechange\":"."\"".number_format($oneHour->get_rainratechange()).",".str_replace('"', '\"',get_img_tag($oneHour->get_rainratechange(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_rainratechange(), true).abs($oneHour->get_rainratechange()))."\"";
$JSON .= ",";
$JSON .= "\"solarradiation\":"."\"".$oneHour->get_solarradiation()."\"";
$JSON .= ",";
$JSON .= "\"srchange\":"."\"".number_format($oneHour->get_srchange()).",".str_replace('"', '\"',get_img_tag($oneHour->get_srchange(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_srchange(), true).abs($oneHour->get_srchange()))."\"";
$JSON .= ",";
$JSON .= "\"pm10\":"."\"".$oneHour->get_pm10()."\"";
$JSON .= ",";
$JSON .= "\"pm10change\":"."\"".number_format($oneHour->get_pm10change()).",".str_replace('"', '\"',get_img_tag($oneHour->get_pm10change(), true)).",".str_replace('"', '\"',get_img_tag($oneHour->get_pm10change(), true).abs($oneHour->get_pm10change()))."\"";
$JSON .= ",";
$JSON .= "\"cloudiness\":"."\"".$oneHour->get_cloudiness()."\"";
$JSON .= "}";

$JSON .= ",\"threeHours\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".$threeHours->get_date()."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$threeHours->get_time()."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$threeHours->get_temp()."\"";
$JSON .= ",";
$JSON .= "\"temp2\":"."\"".$threeHours->get_temp2()."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$threeHours->get_hum()."\"";
$JSON .= ",";
$JSON .= "\"pm10\":"."\"".$threeHours->get_pm10()."\"";
$JSON .= ",";
$JSON .= "\"pm25\":"."\"".$threeHours->get_pm25()."\"";
$JSON .= ",";
$JSON .= "\"pressure\":"."\"".$threeHours->get_pressure()."\"";
$JSON .= ",";
$JSON .= "\"winddir\":"."\"".$threeHours->get_winddir()."\"";
$JSON .= ",";
$JSON .= "\"windspd\":"."\"".$threeHours->get_windspd()."\"";
$JSON .= ",";
$JSON .= "\"rainrate\":"."\"".$threeHours->get_rainrate()."\"";
$JSON .= ",";
$JSON .= "\"cloudbase\":"."\"".$threeHours->get_cloudbase()."\"";
$JSON .= ",";
$JSON .= "\"windchill\":"."\"".$threeHours->get_windchill()."\"";
$JSON .= ",";
$JSON .= "\"heatidx\":"."\"".$threeHours->get_heatidx()."\"";
$JSON .= ",";
$JSON .= "\"thw\":"."\"".$threeHours->get_thw()."\"";
$JSON .= ",";
$JSON .= "\"intemp\":"."\"".$threeHours->get_intemp()."\"";
$JSON .= ",";
$JSON .= "\"tempunit\":"."\"".$threeHours->get_tempunit()."\"";
$JSON .= ",";
$JSON .= "\"solarradiation\":"."\"".$threeHours->get_solarradiation()."\"";
$JSON .= ",";
$JSON .= "\"cloudiness\":"."\"".$threeHours->get_cloudiness()."\"";
$JSON .= "}";

$JSON .= ",\"yestsametime\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".$yestsametime->get_date()."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$yestsametime->get_time()."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$yestsametime->get_temp()."\"";
$JSON .= ",";
$JSON .= "\"temp2\":"."\"".$yestsametime->get_temp2()."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$yestsametime->get_hum()."\"";
$JSON .= ",";
$JSON .= "\"dew\":"."\"".$yestsametime->get_dew()."\"";
$JSON .= ",";
$JSON .= "\"pm10\":"."\"".$yestsametime->get_pm10()."\"";
$JSON .= ",";
$JSON .= "\"pm25\":"."\"".$yestsametime->get_pm25()."\"";
$JSON .= ",";
$JSON .= "\"pressure\":"."\"".$yestsametime->get_pressure()."\"";
$JSON .= ",";
$JSON .= "\"winddir\":"."\"".$yestsametime->get_winddir()."\"";
$JSON .= ",";
$JSON .= "\"windspd\":"."\"".$yestsametime->get_windspd()."\"";
$JSON .= ",";
$JSON .= "\"rainrate\":"."\"".$yestsametime->get_rainrate()."\"";
$JSON .= ",";
$JSON .= "\"cloudbase\":"."\"".$yestsametime->get_cloudbase()."\"";
$JSON .= ",";
$JSON .= "\"uv\":"."\"".$yestsametime->get_uv()."\"";
$JSON .= ",";
$JSON .= "\"uvchange\":"."\"".number_format($yestsametime->get_uvchange()).",".str_replace('"', '\"',get_img_tag($yestsametime->get_uvchange(), true)).",".str_replace('"', '\"',get_img_tag($yestsametime->get_uvchange(), true).abs($yestsametime->get_uvchange()))."\"";
$JSON .= ",";
$JSON .= "\"windchill\":"."\"".$yestsametime->get_windchill()."\"";
$JSON .= ",";
$JSON .= "\"heatidx\":"."\"".$yestsametime->get_heatidx()."\"";
$JSON .= ",";
$JSON .= "\"thw\":"."\"".$yestsametime->get_thw()."\"";
$JSON .= ",";
$JSON .= "\"tempchange\":"."\"".$yestsametime->get_tempchange().",".str_replace('"', '\"', get_img_tag($yestsametime->get_tempchange(), true)).",".str_replace('"', '\"', get_param_tag($yestsametime->get_tempchange(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp2change\":"."\"".$yestsametime->get_temp2change().",".str_replace('"', '\"', get_img_tag($yestsametime->get_temp2change(), true)).",".str_replace('"', '\"', get_param_tag($yestsametime->get_temp2change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"temp3change\":"."\"".$yestsametime->get_temp3change().",".str_replace('"', '\"', get_img_tag($yestsametime->get_temp3change(), true)).",".str_replace('"', '\"', get_param_tag($yestsametime->get_temp3change(), true, ""))."\"";
$JSON .= ",";
$JSON .= "\"humchange\":"."\"".number_format($yestsametime->get_humchange()).",".get_img_tag($yestsametime->get_humchange(), true).",".get_img_tag($yestsametime->get_humchange(), true).abs($yestsametime->get_humchange())."\"";
$JSON .= ",";
$JSON .= "\"dewchange\":"."\"".number_format($yestsametime->get_dewchange()).",".get_img_tag($yestsametime->get_dewchange(), true).",".get_img_tag($yestsametime->get_dewchange(), true).abs($yestsametime->get_dewchange())."\"";
$JSON .= ",";
$JSON .= "\"tempunit\":"."\"".$yestsametime->get_tempunit()."\"";
$JSON .= ",";
$JSON .= "\"solarradiation\":"."\"".$yestsametime->get_solarradiation()."\"";
$JSON .= ",";
$JSON .= "\"srchange\":"."\"".number_format($yestsametime->get_srchange()).",".str_replace('"', '\"',get_img_tag($yestsametime->get_srchange(), true)).",".str_replace('"', '\"',get_img_tag($yestsametime->get_srchange(), true).abs($yestsametime->get_srchange()))."\"";
$JSON .= ",";
$JSON .= "\"pm10change\":"."\"".number_format($yestsametime->get_pm10change()).",".str_replace('"', '\"',get_img_tag($yestsametime->get_pm10change(), true)).",".str_replace('"', '\"',get_img_tag($yestsametime->get_pm10change(), true).abs($yestsametime->get_pm10change()))."\"";
$JSON .= ",";
$JSON .= "\"cloudiness\":"."\"".$yestsametime->get_cloudiness()."\"";
$JSON .= "}";

$JSON .= ",\"thisMonth\":";
$JSON .= "{";
$JSON .= "\"hightemp\":"."\"".$thisMonth->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$thisMonth->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"highhum\":"."\"".$thisMonth->get_highhum()."\"";
$JSON .= ",";
$JSON .= "\"lowhum\":"."\"".$thisMonth->get_lowhum()."\"";
$JSON .= ",";
$JSON .= "\"highdew\":"."\"".$thisMonth->get_highdew()."\"";
$JSON .= ",";
$JSON .= "\"lowdew\":"."\"".$thisMonth->get_lowdew()."\"";
$JSON .= ",";
$JSON .= "\"highbar\":"."\"".$thisMonth->get_highbar()."\"";
$JSON .= ",";
$JSON .= "\"lowbar\":"."\"".$thisMonth->get_lowbar()."\"";
$JSON .= ",";
$JSON .= "\"highwind\":"."\"".$thisMonth->get_highwind()."\"";
$JSON .= ",";
$JSON .= "\"lowwindchill\":"."\"".$thisMonth->get_lowwindchill()."\"";
$JSON .= ",";
$JSON .= "\"highheatindex\":"."\"".$thisMonth->get_highheatindex()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_av\":"."\"".$monthAverge->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_ab\":"."\"".$monthAverge->get_abshightemp()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_ab_date\":"."\"".$monthAverge->get_abshightempdate()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp_av\":"."\"".$monthAverge->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp_ab\":"."\"".$monthAverge->get_abslowtemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp_ab_date\":"."\"".$monthAverge->get_abslowtempdate()."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$thisMonth->get_rain()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$thisMonth->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$thisMonth->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$thisMonth->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$thisMonth->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"prevMonth\":";
$JSON .= "{";
$JSON .= "\"hightemp\":"."\"".$prevMonth->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$prevMonth->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"highhum\":"."\"".$prevMonth->get_highhum()."\"";
$JSON .= ",";
$JSON .= "\"lowhum\":"."\"".$prevMonth->get_lowhum()."\"";
$JSON .= ",";
$JSON .= "\"highdew\":"."\"".$prevMonth->get_highdew()."\"";
$JSON .= ",";
$JSON .= "\"lowdew\":"."\"".$prevMonth->get_lowdew()."\"";
$JSON .= ",";
$JSON .= "\"highbar\":"."\"".$prevMonth->get_highbar()."\"";
$JSON .= ",";
$JSON .= "\"lowbar\":"."\"".$prevMonth->get_lowbar()."\"";
$JSON .= ",";
$JSON .= "\"highwind\":"."\"".$prevMonth->get_highwind()."\"";
$JSON .= ",";
$JSON .= "\"lowwindchill\":"."\"".$prevMonth->get_lowwindchill()."\"";
$JSON .= ",";
$JSON .= "\"highheatindex\":"."\"".$prevMonth->get_highheatindex()."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$prevMonth->get_rain()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$prevMonth->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$prevMonth->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$prevMonth->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$prevMonth->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"thisYear\":";
$JSON .= "{";
$JSON .= "\"hightemp\":"."\"".$thisYear->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$thisYear->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"highhum\":"."\"".$thisYear->get_highhum()."\"";
$JSON .= ",";
$JSON .= "\"lowhum\":"."\"".$thisYear->get_lowhum()."\"";
$JSON .= ",";
$JSON .= "\"highdew\":"."\"".$thisYear->get_highdew()."\"";
$JSON .= ",";
$JSON .= "\"lowdew\":"."\"".$thisYear->get_lowdew()."\"";
$JSON .= ",";
$JSON .= "\"highbar\":"."\"".$thisYear->get_highbar()."\"";
$JSON .= ",";
$JSON .= "\"lowbar\":"."\"".$thisYear->get_lowbar()."\"";
$JSON .= ",";
$JSON .= "\"highwind\":"."\"".$thisYear->get_highwind()."\"";
$JSON .= ",";
$JSON .= "\"lowwindchill\":"."\"".$thisYear->get_lowwindchill()."\"";
$JSON .= ",";
$JSON .= "\"highheatindex\":"."\"".$thisYear->get_highheatindex()."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$thisYear->get_rain()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$thisYear->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$thisYear->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$thisYear->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$thisYear->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"today\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".date("j/n",  mktime ($hour, $min, 0, $month, $day ,$year))."\"";
$JSON .= ",";
$JSON .= "\"morningtemp\":"."\"".$today->get_temp_morning()."\"";
$JSON .= ",";
$JSON .= "\"noontemp\":"."\"".$today->get_temp_day()."\"";
$JSON .= ",";
$JSON .= "\"hightemp\":"."\"".$today->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_time\":"."\"".$today->get_hightemp_time()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_change\":"."\"".get_param_tag($todayForecast->get_hightemp() - round($today->get_hightemp()), true, "", false)."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$today->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp_time\":"."\"".$today->get_lowtemp_time()."\"";
$JSON .= ",";
$JSON .= "\"hightemp2\":"."\"".$today->get_hightemp2()."\"";
$JSON .= ",";
$JSON .= "\"hightemp2_time\":"."\"".$today->get_hightemp2_time()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp2\":"."\"".$today->get_lowtemp2()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp2_time\":"."\"".$today->get_lowtemp2_time()."\"";
$JSON .= ",";
$JSON .= "\"hightemp3\":"."\"".$today->get_hightemp3()."\"";
$JSON .= ",";
$JSON .= "\"hightemp3_time\":"."\"".$today->get_hightemp3_time()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp3\":"."\"".$today->get_lowtemp3()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp3_time\":"."\"".$today->get_lowtemp3_time()."\"";
$JSON .= ",";
$JSON .= "\"highhum\":"."\"".$today->get_highhum()."\"";
$JSON .= ",";
$JSON .= "\"highhum_time\":"."\"".$today->get_highhum_time()."\"";
$JSON .= ",";
$JSON .= "\"lowhum\":"."\"".$today->get_lowhum()."\"";
$JSON .= ",";
$JSON .= "\"lowhum_time\":"."\"".$today->get_lowhum_time()."\"";
$JSON .= ",";
$JSON .= "\"highdew\":"."\"".$today->get_highdew()."\"";
$JSON .= ",";
$JSON .= "\"highdew_time\":"."\"".$today->get_highdew_time()."\"";
$JSON .= ",";
$JSON .= "\"lowdew\":"."\"".$today->get_lowdew()."\"";
$JSON .= ",";
$JSON .= "\"lowdew_time\":"."\"".$today->get_lowdew_time()."\"";
$JSON .= ",";
$JSON .= "\"highbar\":"."\"".$today->get_highbar()."\"";
$JSON .= ",";
$JSON .= "\"lowbar\":"."\"".$today->get_lowbar()."\"";
$JSON .= ",";
$JSON .= "\"highradiation\":"."\"".$today->get_highradiation()."\"";
$JSON .= ",";
$JSON .= "\"highradiation_time\":"."\"".$today->get_highradiation_time()."\"";
$JSON .= ",";
$JSON .= "\"highwind\":"."\"".$today->get_highwind()."\"";
$JSON .= ",";
$JSON .= "\"highwind_time\":"."\"".$today->get_highwind_time()."\"";
$JSON .= ",";
$JSON .= "\"highuv\":"."\"".$today->get_highuv()."\"";
$JSON .= ",";
$JSON .= "\"highuv_time\":"."\"".$today->get_highuv_time()."\"";
$JSON .= ",";
$JSON .= "\"lowwindchill\":"."\"".$today->get_lowwindchill()."\"";
$JSON .= ",";
$JSON .= "\"highheatindex\":"."\"".$today->get_highheatindex()."\"";
$JSON .= ",";
$JSON .= "\"highrainrate\":"."\"".$today->get_highrainrate()."\"";
$JSON .= ",";
$JSON .= "\"highrainrate_time\":"."\"".$today->get_highrainrate_time()."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$today->get_rain2()."\"";
$JSON .= ",";
$JSON .= "\"sunshinehours\":"."\"".$today->get_sunshinehours()."\"";
$JSON .= ",";
$JSON .= "\"sunrise\":"."\"".$sunrise."\"";
$JSON .= ",";
$JSON .= "\"sunset\":"."\"".$sunset."\"";
$JSON .= "}";

$JSON .= ",\"yest\":";
$JSON .= "{";
$JSON .= "\"date\":"."\"".date("j/n",  mktime ($hour, $min, 0, $month, $day-1 ,$year))."\"";
$JSON .= ",";
$JSON .= "\"morningtemp\":"."\"".$yest->get_temp_morning()."\"";
$JSON .= ",";
$JSON .= "\"noontemp\":"."\"".$yest->get_temp_day()."\"";
$JSON .= ",";
$JSON .= "\"nighttemp\":"."\"".$yest->get_temp_night()."\"";
$JSON .= ",";
$JSON .= "\"hightemp\":"."\"".$yest->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"hightemp_change\":"."\"".get_param_tag($todayForecast->get_hightemp() - round($yest->get_hightemp()), true, "", false)."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$yest->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"highhum\":"."\"".$yest->get_highhum()."\"";
$JSON .= ",";
$JSON .= "\"lowhum\":"."\"".$yest->get_lowhum()."\"";
$JSON .= ",";
$JSON .= "\"highdew\":"."\"".$yest->get_highdew()."\"";
$JSON .= ",";
$JSON .= "\"lowdew\":"."\"".$yest->get_lowdew()."\"";
$JSON .= ",";
$JSON .= "\"highbar\":"."\"".$yest->get_highbar()."\"";
$JSON .= ",";
$JSON .= "\"lowbar\":"."\"".$yest->get_lowbar()."\"";
$JSON .= ",";
$JSON .= "\"highwind\":"."\"".$yest->get_highwind()."\"";
$JSON .= ",";
$JSON .= "\"lowwindchill\":"."\"".$yest->get_lowwindchill()."\"";
$JSON .= ",";
$JSON .= "\"highheatindex\":"."\"".$yest->get_highheatindex()."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$yest->get_rain()."\"";
$JSON .= "}";

$JSON .= ",\"wholeSeason\":";
$JSON .= "{";
$JSON .= "\"rain\":"."\"".$wholeSeason->get_rain2()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$wholeSeason->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$wholeSeason->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$wholeSeason->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$wholeSeason->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"seasonTillNow\":";
$JSON .= "{";
$JSON .= "\"rain\":"."\"".$seasonTillNow->get_rain2()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$seasonTillNow->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$seasonTillNow->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$seasonTillNow->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$seasonTillNow->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"averageTillNow\":";
$JSON .= "{";
$JSON .= "\"rain\":"."\"".$averageTillNow->get_rain()."\"";
$JSON .= ",";
$JSON .= "\"rainydays\":"."\"".$averageTillNow->get_rainydays()."\"";
$JSON .= ",";
$JSON .= "\"raindiffav\":"."\"".$averageTillNow->get_raindiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainydaysdiffav\":"."\"".$averageTillNow->get_rainydaysdiffav()."\"";
$JSON .= ",";
$JSON .= "\"rainperc\":"."\"".$averageTillNow->get_rainperc()."\"";
$JSON .= "}";

$JSON .= ",\"storm\":";
$JSON .= "{";
$JSON .= "\"rain\":"."\"".$storm->get_rain()."\"";
$JSON .= "}";

$JSON .= ",\"todayForecast\":";
$JSON .= "{";
$JSON .= "\"hightemp\":"."\"".$todayForecast->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$todayForecast->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"temp_morning\":"."\"".$todayForecast->get_temp_morning()."\"";
$JSON .= ",";
$JSON .= "\"temp_day\":"."\"".$todayForecast->get_temp_day()."\"";
$JSON .= ",";
$JSON .= "\"temp_night\":"."\"".$todayForecast->get_temp_night()."\"";
$JSON .= "}";

$JSON .= ",\"tomorrowForecast\":";
$JSON .= "{";
$JSON .= "\"hightemp\":"."\"".$tomorrowForecast->get_hightemp()."\"";
$JSON .= ",";
$JSON .= "\"lowtemp\":"."\"".$tomorrowForecast->get_lowtemp()."\"";
$JSON .= ",";
$JSON .= "\"temp_morning\":"."\"".$tomorrowForecast->get_temp_morning()."\"";
$JSON .= ",";
$JSON .= "\"temp_day\":"."\"".$tomorrowForecast->get_temp_day()."\"";
$JSON .= ",";
$JSON .= "\"temp_night\":"."\"".$tomorrowForecast->get_temp_night()."\"";
$JSON .= "}";

$JSON .= ",\"forecastHours\":[";
foreach ($forecastHour as $hour_f){
$JSON .= "{";
$JSON .= "\"currentDateTime\":"."\"".$hour_f['currentDateTime']."\"";
$JSON .= ",";
$JSON .= "\"date\":"."\"".date("j/m", $hour_f['currentDateTime'])."\"";
$JSON .= ",";
$JSON .= "\"day0\":"."\"".date("D", $hour_f['currentDateTime'])."\"";
$JSON .= ",";
$JSON .= "\"day1\":"."\"".replaceDays(date("D", $hour_f['currentDateTime'])." ")."\"";
$JSON .= ",";
$JSON .= "\"plusminus\":"."\"".$hour_f['plusminus']."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$hour_f['time']."\"";
$JSON .= ",";
$JSON .= "\"wind\":"."\"".$hour_f['wind']."\"";
$JSON .= ",";
$JSON .= "\"wind_class\":"."\"".getWindInfo($hour_f['wind'], 0)['wind_class']."\"";
$JSON .= ",";
$JSON .= "\"wind_title0\":"."\"".getWindInfo($hour_f['wind'], 0)['windtitle']."\"";
$JSON .= ",";
$JSON .= "\"wind_title1\":"."\"".getWindInfo($hour_f['wind'], 1)['windtitle']."\"";
$JSON .= ",";
$JSON .= "\"icon\":"."\"".$hour_f['icon']."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$hour_f['temp']."\"";
$JSON .= ",";
$JSON .= "\"hum\":"."\"".$hour_f['humidity']."\"";
$JSON .= ",";
$JSON .= "\"rain\":"."\"".$hour_f['rain']."\"";
$JSON .= ",";
$JSON .= "\"uv\":"."\"".$hour_f['UV']."\"";
$JSON .= ",";
$JSON .= "\"dust\":"."\"".$hour_f['dust']."\"";
$JSON .= ",";
$JSON .= "\"cloth\":"."\""."images/clothes/".$hour_f['cloth']."\"";
$JSON .= ",";
$JSON .= "\"title0\":"."\"".$hour_f['title'][0]."\"";
$JSON .= ",";
$JSON .= "\"title1\":"."\"".str_replace('\"', "&quot;", $hour_f['title'][1])."\"";
$lang_idx = 0;
$JSON .= ",";
$JSON .= "\"cloth_title0\":"."\"".getClothTitle($hour_f['cloth'], $hour_f['temp'])."\"";
$lang_idx = 1;
$JSON .= ",";
$JSON .= "\"cloth_title1\":"."\"".getClothTitle($hour_f['cloth'], $hour_f['temp'])."\"";
$JSON .= ",\"recommendations\":[";
$hour_recommendations = getRecommendations(TimeFrame::Hourly, $hour_f['time'],  $hour_f['temp'], $hour_f['wind'], $hour_f['humidity'], $hour_f['rain'], $hour_f['dust'], $hour_f['uv']);
foreach ($hour_recommendations as $r){
$JSON .= "{";
$JSON .= "\"activity\":"."\"".$r['activity']."\",";
//$JSON .= "\"sig\":"."\"".$r['sig']."\",";
$JSON .= "\"value\":"."\"".$r['value']."\"";
$JSON .= "},";
}
$JSON = trim($JSON, ",");
$JSON .= "]";
$JSON .= "},";
}

$JSON = trim($JSON, ",");
$JSON .= "]";
$JSON .= ",\"sigforecastHours\":[";
foreach ($sigforecastHour as $hour_f){
$JSON .= "{";
$JSON .= "\"currentDateTime\":"."\"".$hour_f['currentDateTime']."\"";
$JSON .= ",";
$JSON .= "\"date\":"."\"".date("j/m", $hour_f['currentDateTime'])."\"";
$JSON .= ",";
$JSON .= "\"plusminus\":"."\"".$hour_f['plusminus']."\"";
$JSON .= ",";
$JSON .= "\"time\":"."\"".$hour_f['time']."\"";
$JSON .= ",";
$JSON .= "\"wind\":"."\"".$hour_f['wind']."\"";
$JSON .= ",";
$JSON .= "\"wind_class\":"."\"".getWindInfo($hour_f['wind'], $lang_idx)['wind_class']."\"";
$JSON .= ",";
$JSON .= "\"wind_title0\":"."\"".getWindInfo($hour_f['wind'], 0)['windtitle']."\"";
$JSON .= ",";
$JSON .= "\"wind_title1\":"."\"".getWindInfo($hour_f['wind'], 1)['windtitle']."\"";
$JSON .= ",";
$JSON .= "\"icon\":"."\"".$hour_f['icon']."\"";
$JSON .= ",";
$JSON .= "\"temp\":"."\"".$hour_f['temp']."\"";
$JSON .= ",";
$JSON .= "\"cloth\":"."\"".$hour_f['cloth']."\"";
$JSON .= ",";
$JSON .= "\"title0\":"."\"".$hour_f['title'][0]."\"";
$JSON .= ",";
$JSON .= "\"title1\":"."\"".str_replace('\"', "&quot;", $hour_f['title'][1])."\"";
$JSON .= "},";
}

$JSON = trim($JSON, ",");
$JSON .= "]";
$JSON .= ",\"forecastDays\":[";
$surise_suset_json = getSunriseSunset($day_f['date']);
$day_idx = 0;
foreach ($forecastDaysDB as $day_f){
    $daily_sunrise = $surise_suset_json->location->time[$day_idx]->sunrise->time;
    $daily_sunset = $surise_suset_json->location->time[$day_idx]->sunset->time;
    $daily_moonrise = $surise_suset_json->location->time[$day_idx]->moonrise->time;
    $daily_moonset = $surise_suset_json->location->time[$day_idx]->moonset->time;
    $daily_moonphase = $surise_suset_json->location->time[0]->moonphase->value;
    $day_idx++;
    $lang_idx = 0;
    $JSON .= "{";
    $JSON .= "\"day_name0\":"."\"".$day_f['day_name']."\"";
    $JSON .= ",";
    $JSON .= "\"TempHighClothTitle0\":"."\"".getClothTitle($day_f['TempHighCloth'], $day_f['TempHigh'])."\"";
    $JSON .= ",";
    $JSON .= "\"TempNightClothTitle0\":"."\"".getClothTitle($day_f['TempNightCloth'], $day_f['TempNight'])."\"";
    $JSON .= ",";
    $lang_idx = 1;
    $JSON .= "\"day_name1\":"."\"".replaceDays($day_f['day_name']." ")."\"";
    $JSON .= ",";
    $JSON .= "\"date\":"."\"".$day_f['date']."\"";
    $JSON .= ",";
    $JSON .= "\"TempLow\":"."\"".$day_f['TempLow']."\"";
    $JSON .= ",";
    $JSON .= "\"humMorning\":"."\"".$day_f['humMorning']."\"";
    $JSON .= ",";
    $JSON .= "\"TempLowCloth\":"."\""."images/clothes/".$day_f['TempLowCloth']."\"";
    $JSON .= ",";
    $JSON .= "\"TempLowClothTitle1\":"."\"".getClothTitle($day_f['TempLowCloth'], $day_f['TempLow'])."\"";
    $JSON .= ",";
    $JSON .= "\"TempLowClothTitle0\":"."\"".getClothTitle($day_f['TempLowCloth'], $day_f['TempLow'])."\"";
    $JSON .= ",";
    $JSON .= "\"TempHigh\":"."\"".$day_f['TempHigh']."\"";
    $JSON .= ",";
    $JSON .= "\"humDay\":"."\"".$day_f['humDay']."\"";
    $JSON .= ",";
    $JSON .= "\"visibility\":"."\"".$day_f['visibility']."\"";
    $JSON .= ",";
    $JSON .= "\"windMorning\":"."\"".getWindInfo($day_f['windMorning'], 0)['wind_class']."\"";
    $JSON .= ",";
    $JSON .= "\"windDay\":"."\"".getWindInfo($day_f['windDay'], 0)['wind_class']."\"";
    $JSON .= ",";
    $JSON .= "\"visDay\":"."\"".$day_f['visDay']."\"";
    $JSON .= ",";
    $JSON .= "\"windNight\":"."\"".getWindInfo($day_f['windNight'], 0)['wind_class']."\"";
    $JSON .= ",";
    $JSON .= "\"windMorningSpd\":"."\"".$day_f['windMorning']."\"";
    $JSON .= ",";
    $JSON .= "\"windDaySpd\":"."\"".$day_f['windDay']."\"";
    $JSON .= ",";
    $JSON .= "\"windNightSpd\":"."\"".$day_f['windNight']."\"";
    $JSON .= ",";
    $JSON .= "\"TempNight\":"."\"".$day_f['TempNight']."\"";
    $JSON .= ",";
    $JSON .= "\"humNight\":"."\"".$day_f['humNight']."\"";
    $JSON .= ",";
    $JSON .= "\"TempHighCloth\":"."\""."images/clothes/".$day_f['TempHighCloth']."\"";
    $JSON .= ",";
    $JSON .= "\"TempHighClothTitle1\":"."\"".getClothTitle($day_f['TempHighCloth'], $day_f['TempHigh'])."\"";
    $JSON .= ",";
    $JSON .= "\"TempNightCloth\":"."\""."images/clothes/".$day_f['TempNightCloth']."\"";
    $JSON .= ",";
    $JSON .= "\"TempNightClothTitle1\":"."\"".getClothTitle($day_f['TempNightCloth'], $day_f['TempNight'])."\"";
    $JSON .= ",";
    $JSON .= "\"icon\":"."\""."images/icons/day/".$day_f['icon']."\"";
    $JSON .= ",";
    $JSON .= "\"sunrise\":"."\"".$daily_sunrise."\"";
    $JSON .= ",";
    $JSON .= "\"sunset\":"."\"".$daily_sunset."\"";
    $JSON .= ",";
    $JSON .= "\"uvmax\":"."\"".$day_f['uvmax']."\"";
    $JSON .= ",";
    $JSON .= "\"moonrise\":"."\"".$daily_moonrise."\"";
    $JSON .= ",";
    $JSON .= "\"moonset\":"."\"".$daily_moonset."\"";
    $JSON .= ",";
    $JSON .= "\"moonphase\":"."\"".$daily_moonphase."\"";
    $JSON .= ",";
    $JSON .= "\"rainFrom\":"."\"".$day_f['rainFrom']."\"";
    $JSON .= ",";
    $JSON .= "\"rainTo\":"."\"".$day_f['rainTo']."\"";
    $JSON .= ",";
    $JSON .= "\"morning_icon\":"."\""."images/icons/day/".$day_f['iconmorning']."\"";
    $JSON .= ",";
    $JSON .= "\"night_icon\":"."\""."images/icons/day/".$day_f['iconnight']."\"";
    $JSON .= ",";
    $day_f['lang1'] = preg_replace("/<br\W*?\/>/", " ", $day_f['lang1']);
    $day_f['lang0'] = preg_replace("/<br\W*?\/>/", " ", $day_f['lang0']);
    $JSON .= "\"lang1\":"."\"".str_replace('"', '``',urldecode($day_f['lang1']))."\"";
     $JSON .= ",";
    $JSON .= "\"lang0\":"."\"".urldecode($day_f['lang0'])."\"";
    $JSON .= ",\"recommendations\":[";
    $day_recommendations = getRecommendations(TimeFrame::Daily, $day_idx, $day_f['TempHigh'], $day_f['windDay'], $day_f['humDay'], $day_f['rain'], 0, 0);
    foreach ($hour_recommendations as $r){
    $JSON .= "{";
    $JSON .= "\"activity\":"."\"".$r['activity']."\",";
    //$JSON .= "\"sig\":"."\"".$r['sig']."\",";
    $JSON .= "\"value\":"."\"".$r['value']."\"";
    $JSON .= "},";
    }
    $JSON = trim($JSON, ",");
    $JSON .= "]";
    $JSON .= "},";
}
$random_did_you_know = rand(0, count($DID_YOU_KNOW_EX)-1);
if (($month > 3) && ($month < 11))
    $random_did_you_know = rand(0, count($DID_YOU_KNOW_SUMMER)-1);  
$JSON = trim($JSON, ",");
$JSON .= "]";
$JSON .= ",\"Messages\":";
$JSON .= "{";
$JSON .= "\"latestalert0\":"."\"".urlencode($mem->get('latestalert0'))."\"";
$JSON .= ",";
$JSON .= "\"addonalert0\":"."\"".urlencode($mem->get('addonalert0'))."\"";
$JSON .= ",";
$JSON .= "\"detailedforecast0\":"."\"".urlencode($mem->get('descriptionforecast0'))."\"";
$JSON .= ",";
$JSON .= "\"timeforecast0\":"."\"".date('Y-m-d G:i D', $mem->get('descriptionforecasttime0'))."\"";
$JSON .= ",";
$JSON .= "\"latestalert1\":"."\"".urlencode($mem->get('latestalert1'))."\"";
$JSON .= ",";
$JSON .= "\"latestalert_img\":"."\"".$mem->get('latestalert_img')."\"";
$JSON .= ",";
$JSON .= "\"addonalert1\":"."\"".urlencode($mem->get('addonalert1'))."\"";
$JSON .= ",";
$JSON .= "\"latestalerttype\":"."\"".$mem->get('latestalerttype')."\"";
$JSON .= ",";
$JSON .= "\"latestalertttl\":"."\"".$mem->get('latestalertttl')."\"";
$JSON .= ",";
$JSON .= "\"detailedforecast1\":"."\"".urlencode($mem->get('descriptionforecast1'))."\"";
$JSON .= ",";
$JSON .= "\"passedts\":"."\"".(time() - $mem->get('latestalerttime0'))."\"";
$JSON .= ",";
$JSON .= "\"timeforecast1\":"."\"".replaceDays(date('Y-m-d G:i D ', $mem->get('descriptionforecasttime1')))."\"";
$JSON .= ",";
if (($month > 3) && ($month < 11))
    $JSON .= "\"tip0\":"."\"".$DID_YOU_KNOW_SUMMER[$random_did_you_know][$EN]."\"";
else
    $JSON .= "\"tip0\":"."\"".$DID_YOU_KNOW_EX[$random_did_you_know][$EN]."\"";
$JSON .= ",";
if (($month > 3) && ($month < 11))
    $JSON .= "\"tip1\":"."\"".$DID_YOU_KNOW_SUMMER[$random_did_you_know][$HEB]."\"";
else
    $JSON .= "\"tip1\":"."\"".$DID_YOU_KNOW_EX[$random_did_you_know][$HEB]."\"";
$JSON .= "}";

$JSON .= ",\"windstatus\":";
$JSON .= "{";
$windstatus = str_replace('"', "'", getWindStatus(0));
$JSON .= "\"lang0\":"."\"".$windstatus."\"";
$JSON .= ",";
$windstatus = str_replace('"', "'", getWindStatus(1));
$JSON .= "\"lang1\":"."\"".$windstatus."\"";
$JSON .= "}";

$itfeels = array();
$itfeels = $current->get_itfeels();
$itfeels_avg = $current->get_itfeels_avg();

$JSON .= ",\"feelslike\":";
$JSON .= "{";
$JSON .= "\"state\":"."\"".$itfeels[0]."\"";
$JSON .= ",";
$JSON .= "\"value\":"."\"".$itfeels[1]."\"";
$JSON .= ",";
$JSON .= "\"avg\":"."\"".$itfeels_avg."\"";
$JSON .= "}";

$JSON .= ",\"states\":";
$JSON .= "{";
$index_hour = 0;
foreach ($forecastHour as $hour_f){
    $index_hour++;    
    if (($hour_f['currentDateTime'] - time() >= 0)){
         $nowHourIndex = $index_hour;
         $mem->set('nowHourIndex', $nowHourIndex);
         break;
     } 
 }
$JSON .= "\"nowHourIndex\":"."\"".$nowHourIndex."\"";
$JSON .= ",";
$JSON .= "\"lastForecastUpdateTS\":"."\"".($mem->get('descriptionforecasttime'.$lang_idx))."\"";
$JSON .= ",";
$lang_idx = 0;
if (isOpenOrClose()==$OPEN[$lang_idx]){$window_class="window_open";}else{$window_class="window_closed";};
$JSON .= "\"window_class\":"."\"".$window_class."\"";
$JSON .= ",";
$JSON .= "\"windowtitle0\":"."\"".$YOU_BETTER[$lang_idx]." ".isOpenOrClose()." ".$THE_WINDOW[$lang_idx]."\"";
$JSON .= ",";
$JSON .= "\"windowdesc0\":"."\"".$INSIDE[$lang_idx].": ".$current->get_intemp()." <br/ > ".$OUTSIDE[$lang_idx].": ".$current->get_temp()." <br/>".$PIVOT_DESC[$lang_idx]." ".$PIVOT_TEMP."\"";
$JSON .= ",";
$lang_idx = 1;
$JSON .= "\"windowtitle1\":"."\"".$YOU_BETTER[$lang_idx]." ".isOpenOrClose()." ".$THE_WINDOW[$lang_idx]."\"";
$JSON .= ",";
$JSON .= "\"windowdesc1\":"."\"".$INSIDE[$lang_idx].": ".$current->get_intemp()." <br/ > ".$OUTSIDE[$lang_idx].": ".$current->get_temp()." <br/>".$PIVOT_DESC[$lang_idx]." ".$PIVOT_TEMP."\"";
$JSON .= ",";
$JSON .= "\"israining\":"."\"".isRaining()."\"";
$JSON .= ",";
$JSON .= "\"issnowing\":"."\"".isSnowing()."\"";
$JSON .= ",";
$JSON .= "\"lastUpdateMin\":"."\"".getLastUpdateMin()."\"";
$JSON .= ",";
if ((count($sig) > 1)){
    $sigtitle0 = $sig[0]['sig'][0];
    $sigtitle1 = $sig[0]['sig'][1];
    $sigext0 = $sig[0]['extrainfo'][0][0];
    $sigext0plain = $sig[0]['extrainfo'][0][1];
    $sigext1 = $sig[0]['extrainfo'][1][0];
    $sigext1plain = $sig[0]['extrainfo'][1][1];
}
$JSON .= "\"sigtitle0\":"."\"".$sigtitle0."\"";
$JSON .= ",";
$JSON .= "\"sigtitle1\":"."\"".$sigtitle1."\"";
$JSON .= ",";
$JSON .= "\"sigexthtml0\":"."\"".str_replace('"', "&quot;", $sigext0)."\"";
$JSON .= ",";
$JSON .= "\"sigext0\":"."\"".str_replace('"', "&quot;", $sigext0plain)."\"";
$JSON .= ",";
$JSON .= "\"sigexthtml1\":"."\"".str_replace('"', "&quot;", $sigext1)."\"";
$JSON .= ",";
$JSON .= "\"sigext1\":"."\"".str_replace('"', "&quot;", $sigext1plain)."\"";

$SIGWEATHER_JSON = ", \"sigweather\": [";
foreach ($sig as $sig_i){
    $sigtitle0 = $sig_i['sig'][0];
    $sigtitle1 = $sig_i['sig'][1];
    $sigext0 = $sig_i['extrainfo'][0][0];
    $sigext0plain = $sig_i['extrainfo'][0][1];
    $sigext1 = $sig_i['extrainfo'][1][0];
    $sigext1plain = $sig_i['extrainfo'][1][1];
    $SIGWEATHER_JSON .= "{\"sigtitle0\":"."\"".$sigtitle0."\", 
               \"sigtitle1\":"."\"".$sigtitle1."\", 
               \"sigexthtml0\":"."\"".str_replace('"', "&quot;", $sigext0)."\" , 
               \"sigext0\":"."\"".str_replace('"', "&quot;", $sigext0plain)."\",
               \"sigexthtml1\":"."\"".str_replace('"', "&quot;", $sigext1)."\",
               \"sigext1\":"."\"".str_replace('"', "&quot;", $sigext1plain)."\",
               \"url\":"."\"".$sig_i['url']."\"  }";
    $SIGWEATHER_JSON .= ",";
}
$SIGWEATHER_JSON = rtrim($SIGWEATHER_JSON, ",");
$SIGWEATHER_JSON .= "]";
$JSON .= $SIGWEATHER_JSON;
$JSON .= "}";
$RUNWALK_JSON = ", \"sigRunWalkweather\": [";
foreach ($sigRun as $sig_i){
    $sigtitle0 = $sig_i['sig'][0];
    $sigtitle1 = $sig_i['sig'][1];
    $sigext0 = $sig_i['extrainfo'][0][0];
    $sigext0plain = $sig_i['extrainfo'][0][1];
    $sigext1 = $sig_i['extrainfo'][1][0];
    $sigext1plain = $sig_i['extrainfo'][1][1];
    $RUNWALK_JSON .= "{\"sigtitle0\":"."\"".$sigtitle0."\", 
               \"sigtitle1\":"."\"".$sigtitle1."\", 
               \"sigext0\":"."\"".str_replace('"', "&quot;", $sigext0)."\" , 
               \"sigext1\":"."\"".str_replace('"', "&quot;", $sigext1)."\",
               \"url\":"."\"".$sig_i['url']."\"  }";
               $RUNWALK_JSON .= ",";
}
$RUNWALK_JSON = rtrim($RUNWALK_JSON, ",");
$RUNWALK_JSON .= "]";
$JSON .= $RUNWALK_JSON; 

$FORECASTCALC_JSON = ", \"sigForecastCalc\": [";
foreach ($sigForecast as $sig_i){
    $sigtitle0 = $sig_i['sig'][0];
    $sigtitle1 = $sig_i['sig'][1];
    $sigext0 = $sig_i['extrainfo'][0][0];
    $sigext0plain = $sig_i['extrainfo'][0][1];
    $sigext1 = $sig_i['extrainfo'][1][0];
    $sigext1plain = $sig_i['extrainfo'][1][1];
    $FORECASTCALC_JSON .= "{\"sigtitle0\":"."\"".$sigtitle0."\", 
               \"sigtitle1\":"."\"".$sigtitle1."\", 
               \"sigext0\":"."\"".str_replace('"', "&quot;", $sigext0)."\" , 
               \"sigext1\":"."\"".str_replace('"', "&quot;", $sigext1)."\",
               \"url\":"."\"".$sig_i['url']."\"  }";
               $FORECASTCALC_JSON .= ",";
}
$FORECASTCALC_JSON = rtrim($FORECASTCALC_JSON, ",");
$FORECASTCALC_JSON .= "]";
$JSON .= $FORECASTCALC_JSON; 

$JSON .= ",\"LatestUserPic\":[";
$result = db_init("SELECT * FROM UserPicture where approved=1 order by uploadedAt DESC LIMIT 7","");
while ($line = $result["result"]->fetch_array(MYSQLI_ASSOC)) {
    $picname = "images/userpic/".$line["picname"];
    $JSON .= "{";
    $JSON .= "\"picname\":"."\"".$picname."\"";
    $JSON .= ",";
    $JSON .= "\"comment\":"."\"".urlencode($line["comment"])."\"";
    $JSON .= ",";
    $JSON .= "\"name\":"."\"".str_replace('"', "&quot;", $line["name"])."\"";
    $JSON .= ",";
    $JSON .= "\"passedts\":"."\"".(time() - filemtime($picname))."\"";
    $JSON .= "},";
}
$JSON = rtrim($JSON, ",");
$JSON .= "]";
$JSON .= ",\"LatestPicOfTheDay\":";
$result = db_init("SELECT * FROM PicOfTheDay order by uploadedAt DESC LIMIT 1","");
while ($line = $result["result"]->fetch_array(MYSQLI_ASSOC)) { 

    $picname = "images/picOfTheDay/".$line["picname"];
    $JSON .= "{";
    $JSON .= "\"picurl\":"."\"".$picname."\"";
    $JSON .= ",";
    $JSON .= "\"caption0\":"."\"".urlencode($line["comment0"])."\"";
    $JSON .= ",";
    $JSON .= "\"caption1\":"."\"".urlencode($line["comment1"])."\"";
    $JSON .= ",";
    $JSON .= "\"passedts\":"."\"".(time() - filemtime($picname))."\"";
    $JSON .= "}";
}

$JSON .= ",\"TAF\":";
$JSON .= "{";
$JSON .= "\"timetaf\":"."\"".$mem->get("timetaf")."\"";
$JSON .= ",";
$JSON .= "\"dayF\":"."\"".$dayF."\"";
$JSON .= ",";
$JSON .= "\"monthF\":"."\"".$monthF."\"";
$JSON .= ",";
$JSON .= "\"yearF\":"."\"".$yearF."\"";
$JSON .= "}";

$ADS_JSON = ",\"Ads\":[";
$Ads = $mem->get('Ads');
foreach ($Ads as $ad){
$ADS_JSON .= "{";
$ADS_JSON .= "\"img_url\":"."\"".$ad['img_url']."\"";
$ADS_JSON .= ",";
$ADS_JSON .= "\"width\":"."\"".$ad['w']."\"";
$ADS_JSON .= ",";
$ADS_JSON .= "\"height\":"."\"".$ad['h']."\"";
$ADS_JSON .= ",";
$ADS_JSON .= "\"link\":"."\"".$ad['href']."\"";
$ADS_JSON .= "},";
}
$ADS_JSON = rtrim($ADS_JSON, ",");
$ADS_JSON .= "]";
$JSON .= $ADS_JSON;
$JSON .= ",\"desc\":";
$JSON .= "{";
$JSON .= "\"temp3_desc0\":"."\"".$ROAD_EXP[0]."\"";
$JSON .= ",";
$JSON .= "\"temp3_desc1\":"."\"".$ROAD_EXP[1]."\"";
$JSON .= ",";
$JSON .= "\"temp3_night_desc0\":"."\"".$ROAD_EXP_NIGHT[0]."\"";
$JSON .= ",";
$JSON .= "\"temp3_night_desc1\":"."\"".$ROAD_EXP_NIGHT[1]."\"";
$JSON .= ",";
$JSON .= "\"early_morning0\":"."\"".$EARLY_MORNING[0]."\"";
$JSON .= ",";
$JSON .= "\"early_morning1\":"."\"".$EARLY_MORNING[1]."\"";
$JSON .= ",";
$JSON .= "\"noon0\":"."\"".$NOON[0]."\"";
$JSON .= ",";
$JSON .= "\"noon1\":"."\"".$NOON[1]."\"";
$JSON .= ",";
$JSON .= "\"night_temp_exp0\":"."\"".$NIGHT_TEMP_EXP[0]."\"";
$JSON .= ",";
$JSON .= "\"night_temp_exp1\":"."\"".$NIGHT_TEMP_EXP[1]."\"";
$JSON .= ",";
$lang_idx = 0;
$JSON .= "\"month_in_word0\":"."\"".getMonthName(date("n",  $updatedStationDate))."\"";
$JSON .= ",";
$lang_idx = 1;
$JSON .= "\"month_in_word1\":"."\"".getMonthName(date("n",  $updatedStationDate))."\"";
$JSON .= "}";

$JSON .= ",\"logo\":";
$JSON .= "{";
$JSON .= "\"logo0\":"."\"".$LOGO[0]."\"";
$JSON .= ",";
$JSON .= "\"logo1\":"."\"".$LOGO[1]."\"";
$JSON .= "}";

$JSON .= "}";
$JSON .= "}";

echo $JSON;
$JSON_SHORT = $CURRENT_JSON.$RUNWALK_JSON."}";
$file = fopen($output_json_file_path_short,"w");
@fwrite ($file, $JSON_SHORT);
@fclose ($file);

 ?>